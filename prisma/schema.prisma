// Arquivo: prisma/schema.prisma - VERSÃO COM SISTEMA DE INDICAÇÃO

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          Int      @id @default(autoincrement())
  email       String   @unique
  name        String?
  password    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // --- CAMPOS NOVOS PARA O MMN ---
  referralCode String?  @unique // O código único de convite deste usuário (ex: JOAO123)
  
  referrerId   Int?     // O ID do "padrinho" que convidou este usuário (opcional)
  
  // Relações de apadrinhamento
  referrer     User?    @relation("Referrals", fields: [referrerId], references: [id]) // Quem é o meu padrinho
  referrals    User[]   @relation("Referrals") // Quem são os meus afiliados
  
  
  // Relações existentes
  investments Investment[]
  wallet      Wallet?
}

model Plan {
  id            Int      @id @default(autoincrement())
  name          String   @unique
  price         Float
  dailyReturn   Float
  
  investments   Investment[]
}

model Investment {
  id        Int      @id @default(autoincrement())
  startDate DateTime @default(now())
  status    String   @default("ACTIVE")

  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  planId    Int
  plan      Plan     @relation(fields: [planId], references: [id])
}

model Wallet {
  id                  Int      @id @default(autoincrement())
  balance             Float    @default(0.0)
  referralBalance     Float    @default(0.0)

  userId              Int      @unique
  user                User     @relation(fields: [userId], references: [id])

  transactions        Transaction[]
}

model Transaction {
  id                  Int      @id @default(autoincrement())
  amount              Float
  type                String
  description         String
  createdAt           DateTime @default(now())

  walletId            Int
  wallet              Wallet   @relation(fields: [walletId], references: [id])
}